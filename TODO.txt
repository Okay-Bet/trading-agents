# Pamela Trading Agent TODO

## Goal
Create an autonomous trading agent that can:
1. Read markets
2. Buy YES or NO in markets  
3. See portfolio
4. SELL positions
5. REDEEM winning positions after resolving

## Current Status (Based on Git Log & Code Review)

### ‚úÖ COMPLETED
- [x] Read markets - Multiple actions implemented:
  - getSamplingMarkets - Get active markets with rewards
  - searchMarketsAction - Search markets in database
  - explainMarketAction - Explain specific market with prices
  - getMarketDataAction - Get market data by condition ID
  - getOrderBookSummaryAction - Order book data
  
- [x] Buy YES/NO - placeOrderAction implemented and working
  - Recent commits show condition ID resolution working
  - Can place limit and market orders
  
- [x] See portfolio - getPortfolioPositionsAction implemented
  - Shows current positions and holdings
  - Recent commit: "portfolio actually working"
  
- [x] SELL positions - sellOrderAction implemented  
  - Recent commit: "sell works by looking up the orderbook first"
  - Now works with derived L2 credentials

### ‚ùå TODO
- [ ] REDEEM winning positions after market resolves
  - No redeem action found in codebase
  - Need to implement redeemPosition.ts
  - Need to add to plugin.ts actions array

## Testing Plan

### 1. Test Existing Functionality (Before Implementing Redeem)
- [x] Start agent with `cd apps/agent && npm start`
- [x] In another terminal: `cd apps/agent && bun run test`
- [ ] Manual testing via conversation:
  
  a) Test Market Reading: ‚úÖ WORKING
     - "Show me some active markets" 
     - "Search for markets about [topic]" ‚úÖ Tested with "show me markets about f1"
     - "Explain market [market name or ID]"
  
  b) Test Buying: üîß FIXED ORDER EXECUTION ISSUES
     - "Buy $10 of YES on [market name]"
     - "Buy $10 of NO on [market name] at 0.65"
     - Fixed Issues:
       * ‚úÖ Cloudflare 403 error (user fixed)
       * ‚úÖ Minimum order size error - now enforces $1 minimum or 5 tokens
       * ‚úÖ FOK order execution error - changed to GTC for better fills
     - Implementation:
       * Market orders now use GTC instead of FOK
       * Price set to 0.995 for BUY and 0.005 for SELL (with buffer)
       * Minimum order size enforced (5 tokens or $1, whichever is larger)
  
  c) Test Portfolio:
     - "Show my portfolio"
     - "What positions do I have?"
  
  d) Test Selling:
     - "Sell my position in [market name]"
     - "Sell 50% of my YES shares in [market]"

### 2. Implementation Tasks
- [ ] Create apps/agent/plugin-polymarket/src/actions/redeemPosition.ts
- [ ] Implement redeem logic:
  - Check if market is resolved
  - Calculate winnings based on outcome
  - Submit redemption transaction
- [ ] Add redeemPositionAction to plugin.ts actions array
- [ ] Write tests in plugin-polymarket/__tests__/redeemPosition.test.ts

### 3. Test Complete Flow
- [ ] Full trading lifecycle test:
  1. Find an interesting market
  2. Place a buy order
  3. Check portfolio to confirm position
  4. Sell partial position
  5. Wait for market to resolve
  6. Redeem winning position

## Notes
- Use `bun run test` in apps/agent to run tests while developing
- Check docker-compose logs if agent isn't responding: `docker-compose logs -f agent`
- Git log shows recent progress on sell functionality and portfolio viewing
- All core trading features except REDEEM are implemented